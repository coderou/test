1.复习
  1.swiper注意点:一定要等数据回来,dom元素渲染后,才new
  2.利用$bus,点击下面的swiper,通知放大镜更新图片显示
  3.attr选择时,直接将响应式对象传递给他显示,当改变对象的某属性,会响应式地更新视图
  4.更新Detail/InputNumber.vue
  5.blur:失去焦点才会判断,input只要输入就会判断,v-model会一直校验,非法的无法输入(是直接被修正了)
    看情况,如果需要严格校验,直接v-model,如果不是对校验很严格,希望兼容低端机器,用blur进行判断
  6.如何等待购物车添加成功再跳转?
    将store里面的actions的addCartList里面的req请求axios返回出去
  7.sessionStorage和localStorage的区别:local是永久,session是会话临时存储,会话:打开浏览器打开页面就在,关闭就没了
  8.2021年3月16日09:01:30,检查口罩
  9.当2个组件都在才能用全局事件总线
  10.请求拦截器:设置公共的请求参数,响应拦截器:设置报错响应
    tip:Nprogress:只有开始\结束是准确的
2.购物车步骤分析
  1.#store/modules/shopcart.js
    getters计算totalPrice[通过reduce],checkedNum[reduce]
  2.映射getter #ShopCart.vue
    import
    computed
    methods
    展示getters数据
    -完成总价和商品数量
  3.store
    定义actions[{id,isChechked}]
    then触发commit
    定义mutations,更新cartList的状态,利用find函数
  4.给input绑定change事件,触发发送请求
    tip:定义接口的时候,接口文档是有可能出错的,这里不是GET,有可能是PUT\PATCH
    but:还会报错了.,...
    然后看ID是不是错误的-->用postman测试
    然后发现isChecked是0\1,不是false或者true,请求方式还是GET,没设计好
  5.store/modules/shopcart.js
    定义getter的isCheckAll
    !!a  将a转换为布尔值  等价于 Boolean(a)
  6.在更新的时候更新Vuex的数据
    QA:s===a=1是什么意思?
    接口没有全选的话,当点击全选,就直接发送需要修改的
    遇到多个请求发,等都更新完成再返回,用Promise.all
  tip:增删改查是以后开发最常见的功能,必须要会
3.代码实现:
  tip:fixBug
  #views/Detail/InputNumber/InputNumber.vue 
  {
    export default{
      watch:{
        newValue(newVal,oldVal){
          ...
          finalVal.Math.ceil(finalVal);// 用户数输入小数取整
        }
      }
    }
  }
  #store/modules/shopcart.js
  {
    import {reqUpdateCartList} from '@/api/shopcart'

    export const getters = {
      // 1.总价
      totalPrice(state) {
        // reduce查找商品的isChecked为1(转换boolean为true,0为false),添加其Price*num
        return state.cartList.reduce((p, c) => p + (c.isChecked ? c.skuPrice * c.skuNum : 0), 0);
      },
      // 2.已选商品的数量
      checkedNum(state) {
        return state.cartList.reduce((p, c) => p + (c.isChecked ? c.skuNum : 0), 0);
      },
      // 3.是否全选
      isCheckAll(state) {
        return !state.cartList.find((cart) => !cart.isChecked);
      },
    };

    export const actions={
      // 3.更新购物车某商品状态
      updateCartList({ commit }, { skuId, isChecked }) {
        reqUpdateCartList(skuId, isChecked).then(() => {
          commit('UPDATE_CART_LIST', { skuId, isChecked });
        });
      },
    }

    export const mutations={
      UPDATE_CART_LIST(state, { skuId, isChecked }) {
        // 找到符合Id的购物车cart商品
        const cart = state.cartList.find(() => cart.skuId === skuId);
        // 更新isChecked
        cart.isChecked = isChecked;
      },
    }
  }
  #views/ShopCart/ShopCart.vue
  {
    <template>
      <li class="cart-list-con1">
        <input
          type="checkbox"
          name="chk_list"
          :checked="cart.isChecked"
          @change="handleChecked(cart.skuId, !cart.isChecked)"
        />
      </li>
      ...
      <div class="select-all">
        <input
          class="chooseAll"
          :checked="isCheckAll"
          @change="handleCheckALl"
          type="checkbox"
        />
        <span>全选</span>
      </div>
      ...
      <div class="chosed">
        已选择 <span>{{ checkedNum }}</span
      >件商品
      </div>
      <div class="sumprice">
        <em>总价（不含运费） ：</em>
        <i class="summoney">{{ totalPrive }}</i>
      </div>
    </template>
    <script>
      import {mapGetters} from 'vuex'
      export default{
        computed:{
          ...mapGetters(['totalPrice', 'checkedNum', 'isCheckAll'])
        },
        methods:{
          ...mapActions(['updateCartList']),
          handleChecked(skuId,isChecked){
            // isChecked 值为1或0
            // tip:直接取反是因为你要改变的就是现在的取反
            this.updateCartList({ skuId, isChecked: isChecked ? 1 : 0 });
          },
          handleCheckALl() {},
        },
      };
    </script>
  }
4.完成商品删除:
  #store/modules/shopcart.js
  {
    import {reqDeleteCartList} from '@/api/shopcart';

    export const actions={
      // 4.删除购物车某商品
      deleteCartList({ commit }, skuId) {
        reqDeleteCartList(skuId).then(() => {
          commit('DELETE_CART_LIST', skuId);
        });
      },
    };

    export const mutations={
      DELETE_CART_LIST(state, skuId) {
        state.cartList = state.cartList.filter((cart) => {
          console.log(cart.skuId, skuId);
          return cart.skuId !== skuId;
        });
      },
    }
  }
  #views/ShopCart/ShopCart.vue
  {
    <template>
      <a href="#none" class="sindelet" @click.prevent="deleteCartList(cart.skuId)">删除</a>
    </template>
    <script>
      export default{
        methods:{
          ...mapActions(['deleteCartList']),
        }
      }
    </script>
  }
5.完成商品全选操作:
  #store/modules/shopcart.js
  {
    export const actions={
      // 5.更新全部商品状态
      updateAllCartList({ commit }, { idArr, isCheckAll }) {
        // console.log(idArr, isCheckAll);
        const requestArr = [];
        idArr.forEach((skuId) => {
          requestArr.push(reqUpdateCartList(skuId, isCheckAll));
        });
        Promise.all(requestArr).then(() => {
          commit('UPDATE_ALL_CART_LIST', isCheckAll);
        });
      },
    };

    export const mutations={
      UPDATE_ALL_CART_LIST(state, isCheckAll) {
        state.cartList.forEach((i) => {
          i.isChecked = isCheckAll;
        });
      },
    }
  }
  #views/ShopCart/ShopCart.vue
  {
    <template>
      <input
        class="chooseAll"
        :checked="isCheckAll"
        @change="handleCheckALl(!isCheckAll)"
        type="checkbox"
      />
      <span>全选</span>
    </template>
    <script>
      export default{
        methods:{
          ...maActions(['updateAllCartList'])
        },
        handleCheckALl(isCheckAll) {
          const idArr = [];
          // 变量当前cartList的所有cart,如果cart.isChecked !== isCheckAll[目标修改值],说明需要修改
          this.cartList.forEach((cart) => {
            if (!!cart.isChecked !== isCheckAll) {
              idArr.push(cart.skuId);
            }
          });
          // tip:是0/1不是false/true
          isCheckAll = isCheckAll ? 1 : 0;
          this.updateAllCartList({ idArr, isCheckAll });
        },
      }
    </script>
  }
6.完成商品删除选中操作:
  #store/modules/shopcart.js
  {
    export const actions={
      // 6.删除选中商品
      deletePartCartList({ commit }, idArr) {
        const requestArr = [];
        idArr.forEach((skuId) => {
          requestArr.push(reqDeleteCartList(skuId));
        });
        Promise.all(requestArr).then(() => {
          commit('DELETE_PART_CART_LIST');
        });
      },
    };

    export const mutations={
      DELETE_PART_CART_LIST(state) {
        state.cartList = state.cartList.filter((i) => !i.isChecked);
      },
    };
  }
  #views/ShopCart/ShopCart.vue
  {
    <template>
      <a href="#none" @click.prevent="handleDeletePart">删除选中的商品</a>
    </template>
    <script>
      export default{
        methods:{
          ...maoActions(['deletePartCartList']),
          handleDeletePart() {
            const idArr = [];
            this.cartList.forEach((cart) => {
              if (cart.isChecked) {
                idArr.push(cart.skuId);
              }
            });
            this.deletePartCartList(idArr);
          },
        }
      }
    </script>
  }
7.图片没有跨域问题
8.验证码不可能在前台验证
  前端一般都是验证位数,验证你写了没写
  如果你能在前台验证,就表示前台有验证码,即不需要任何人手机,都可以注册,是非常危险的
9.为什么要有验证码?
  1.验证机器
  2.验证手机
10.表单校验的库:搜索:vue validate
11.尾递归优化?
12.作用域插槽:一般是用template,直接在标签中写是废弃的语法?
13.2021年3月16日14:26:25 
14.2021年3月16日14:57:35 结束
15.使用验证npm包对表单进行验证
  #终端
  tip:4版本支持的是vue3
  {
    yarn add vee-validate@3
  }
  #main.js
  {
    import { ValidationObserver, ValidationProvider } from 'vee-validate';
    Vue.component('ValidationObserver', ValidationObserver);
    Vue.component('ValidationProvider', ValidationProvider);
  }
  #views/Register/Register.vue
  {
    <template>
      <div class="register">
        <h3>...</h3>
        <ValidationObserver v-slot="{ handleSubmit }">
          <form @submit.prevent="handleSubmit(onSubmit)">
            <ValidationProvider
              class="content"
              name="phone"
              rules="required|phone"
              v-slot="{ errors }"
              tag="div"
              mode="eager"
            >
              <label>手机号:</label>
              <input v-model="phone" type="text" placeholder="请输入你的手机号" />
              <span class="error-msg">{{ errors[0] }}</span>
            </ValidationProvider>
            <ValidationProvider
              class="content"
              name="code"
              rules="required|code"
              v-slot="{ errors }"
              tag="div"
              mode="eager"
            >
              <label>验证码:</label>
              <input v-model="code" type="text" placeholder="请输入验证码" />
              <img
                ref="code"
                src="http://39.98.123.211/api/user/passport/code"
                alt="code"
              />
              <span class="error-msg">{{ errors[0] }}</span>
            </ValidationProvider>
            <ValidationProvider
              class="content"
              name="password"
              rules="required|password"
              v-slot="{ errors }"
              tag="div"
              mode="eager"
            >
              <label>登录密码:</label>
              <input
                v-model="password"
                type="text"
                placeholder="请输入你的登录密码"
              />
              <span class="error-msg">{{ errors[0] }}</span>
            </ValidationProvider>
            <ValidationProvider
              class="content"
              name="rePassword"
              :rules="`required|rePassword:${password}`"
              v-slot="{ errors }"
              tag="div"
              mode="eager"
            >
              <label>确认密码:</label>
              <input
                v-model="rePassword"
                type="text"
                placeholder="请输入确认密码"
              />
              <span class="error-msg">{{ errors[0] }}</span>
            </ValidationProvider>
            <ValidationProvider
              class="controls"
              name="isChecked"
              rules="isChecked"
              v-slot="{ errors }"
              tag="div"
              mode="eager"
            >
              <input v-model="isChecked" name="m1" type="checkbox" />
              <span>同意协议并注册《尚品汇用户协议》</span>
              <span class="error-msg">{{ errors[0] }}</span>
            </ValidationProvider>
            <div class="btn">
              <button>完成注册</button>
            </div>
          </form>
        </ValidationObserver>
      </div>
    </template>
    <script>
      import { extend } from 'vee-validate';
      import { required } from 'vee-validate/dist/rules';

      // 至少8个字符，至少1个大写字母，1个小写字母和1个数字：
      // const passwordReg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;
      const phoneReg = /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;
      const codeReg = /^[0-9A-Za-z]{4}$/;

      // 0.必填
      extend('required', {
        ...required,
        message: '这是必填项',
      });
      // 1.校验勾选协议
      extend('isChecked', {
        validate(value) {
          return value;
        },
        message: '请勾选XXX协议',
      });
      // 2.校验手机号
      extend('phone', {
        validate(value) {
          if (phoneReg.test(value)) {
            return true;
          }
          return '输入的手机号不合法,请重新输入';
        },
        // message:'输入的手机号不合法,请重新输入',
      });
      // 3.校验验证码
      extend('code', {
        validate(value) {
          if (value.length !== 4) {
            return '验证码长度为4位';
          }
          if (!codeReg.test(value)) {
            return '输入的验证码不合法,请重新输入';
          }
          return true;
        },
        // message:"xx"
      });
      // 4.校验密码
      extend('password', {
        validate() {
          return true;
        },
      });
      // 5.校验再次输入密码
      extend('rePassword', {
        validate(val, { password }) {
          if (val === password) return true;
          return '两次密码输入不一致';
        },
        // message:'xx'
        params: ['password'], // 声明参数的名称,相当于props
      });
      export default{
        data(){
          return {
            phone: '',
            code: '',
            password: '',
            rePassword: '',
            isChecked: false,
          };
        },
        methods:{
          // 表单提交方法
          onSubmit(){
            console.log('表单提交')
          }
        }
      }
    </script>
  }









